享元模式(Flyweight Pattern)：运用共享技术有效地支持大量细粒度对象的复用。系统只使用少量的对象，而这些对象都很相似，状态变化很小，可以实现对象的多次复用。由于享元模式要求能够共享的对象必须是细粒度对象，因此它又称为轻量级模式，它是一种对象结构型模式。

一个软件系统在运行时所创建的相同或相似对象数量太多，将导致运行代价过高，带来系统资源浪费、性能下降等问题，这时候可以利用享元模式，构建享元池，在池子中存放共享的对象，需要的时候可以通过工厂获取，甚至于取出对象时设置各自不同的外部状态，这样对外就会有不同的表现。

享元模式的设计一个关键的地方是先要区分**内部状态**和**外部状态**

+ 内部状态：存储在享元对象内部并且不会随环境改变而改变的状态，内部状态可以共享（例如：字符的内容）
+ 外部状态：随环境改变而改变的、**不可以共享的状态**。享元对象的外部状态通常由客户端保存，并在享元对象被创建之后，需要使用的时候再传入到享元对象内部。一个外部状态与另一个外部状态之间是相互独立的（例如：字符的颜色和大小）

所以我们我们存在享元池的也仅仅是**封装具有相同内部状态的的对象**，这样才能共享，同时我们可以接口去能够注入外部状态，便可以获得一系列相似的对象。



(1) 模式特点

1. 可以减少内存中对象的数量，使得相同或者相似的对象在内存中只保存一份，从而可以节约系统资源，提高系统性能
2. 外部状态相对独立，而且不会影响其内部状态，从而使得享元对象可以在不同的环境中被共享

(2) 模式缺点

1. 使得系统变得复杂，需要分离出内部状态和外部状态，这使得程序的逻辑复杂化
2. 为了使对象可以共享，享元模式需要将享元对象的部分状态外部化，而读取外部状态将使得运行时间变长

五、使用情景

1. 一个系统有大量相同或者相似的对象，造成内存的大量耗费 *(例子里的 CPiece对象本身)*
2. 对象的大部分状态都可以外部化，可以将这些外部状态传入对象中 *(例子里的 pointTag)*
3. 在使用享元模式时需要维护一个存储享元对象的享元池 *(例子里的 map)*，而这需要耗费一定的系统资源，因此，在需要多次重复使用享元对象时才值得使用享元模式(此时才算是能够节省空间)。



根据代码示例的结果，我们可以发现，我们所创建的2个棋子对象都是共享对象，实际上并不是每个棋子都需要new, 我们只为不同颜色的棋子创建一个对象，相同颜色的棋子使用的是同一个对象。
这里可以变的参数是**Point的坐标**，每次往棋盘上放的 *(放入享元池的)*，其实是Point。
棋子只是一个共享体，它们**共享的是颜色Color**。而每个棋子**真正不同的地方是Point**，所以**每次setPoint**时必须要**创建一个新的Point对象**!

Draw a White at (2,3)
Draw a Black at (4,5)
Draw a White at (2,4)
Draw a Black at (3,5)
color: 1 point: 2,4 0x7b41d0
color: 0 point: 3,5 0x7b42b0
Show all cheses
(2,3) has a White chese.Address: 0x7b41d0
(2,4) has a White chese.Address: 0x7b41d0
(3,5) has a Black chese.Address: 0x7b42b0
(4,5) has a Black chese.Address: 0x7b42b0


当给pointTag类的构造函数添加日志信息:

pointTag()
pointTag(): 2,3
Draw a White at (2,3)
pointTag()
pointTag(): 4,5
Draw a Black at (4,5)
pointTag(): 2,4
Draw a White at (2,4)
pointTag(): 3,5
Draw a Black at (3,5)
color: 1 point: 2,4 0x7141d0
color: 0 point: 3,5 0x7142b0
Show all cheses
(2,3) has a White chese.Address: 0x7141d0
(2,4) has a White chese.Address: 0x7141d0
(3,5) has a Black chese.Address: 0x7142b0
(4,5) has a Black chese.Address: 0x7142b0


Reference:
+ https://www.cnblogs.com/ring1992/p/9593235.html